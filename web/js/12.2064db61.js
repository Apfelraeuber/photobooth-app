"use strict";(globalThis["webpackChunkqPhotobooth"]=globalThis["webpackChunkqPhotobooth"]||[]).push([[12],{7012:(e,o,l)=>{l.r(o),l.d(o,{default:()=>P});var t=l(9835),r=l(6970);const n={class:"q-gutter-sm"};function a(e,o,l,a,s,c){const i=(0,t.up)("q-tab"),m=(0,t.up)("q-tabs"),u=(0,t.up)("q-separator"),g=(0,t.up)("blitz-form"),p=(0,t.up)("q-card"),d=(0,t.up)("q-btn"),f=(0,t.up)("q-page-sticky"),b=(0,t.up)("q-page");return(0,t.wg)(),(0,t.j4)(b,{padding:""},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{modelValue:a.selected_group,"onUpdate:modelValue":o[0]||(o[0]=e=>a.selected_group=e),class:"text-grey","active-color":"secondary","indicator-color":"secondary","mobile-arrows":"",align:"justify"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(a.main_groups,(e=>((0,t.wg)(),(0,t.j4)(i,{key:e,label:e,name:e},null,8,["label","name"])))),128))])),_:1},8,["modelValue"]),(0,t.Wm)(u),(0,t._)("div",null,(0,r.zw)(a.group_description),1),(0,t.Wm)(p,{class:"q-pa-md q-mt-md"},{default:(0,t.w5)((()=>[a.renderBlitzForm?((0,t.wg)(),(0,t.j4)(g,{modelValue:a.serverConfig[a.selected_group],"onUpdate:modelValue":o[1]||(o[1]=e=>a.serverConfig[a.selected_group]=e),key:a.selected_group,schema:a.schema_blitzar,internalLabels:!1,columnCount:2,class:"blitzar-form"},null,8,["modelValue","schema"])):(0,t.kq)("",!0)])),_:1}),(0,t.Wm)(f,{position:"bottom-right",offset:[25,25]},{default:(0,t.w5)((()=>[(0,t._)("div",n,[(0,t.Wm)(d,{label:"reset",onClick:o[2]||(o[2]=e=>a.remoteProcedureCall("/cmd/config/reset"))}),(0,t.Wm)(d,{label:"restore",onClick:o[3]||(o[3]=e=>a.restoreConfig())}),(0,t.Wm)(d,{color:"primary",label:"persist",onClick:o[4]||(o[4]=e=>a.uploadConfigAndPersist())})])])),_:1})])),_:1})}l(6727),l(9665);var s=l(499),c=l(1569),i=l(9302),m=l(7575),u=l(3746),g=l(6380);const p={components:{BlitzForm:g.lU},setup(){const e=(0,i.Z)(),o=(0,m.h)();let{serverConfig:l}=(0,u.Jk)(o),r={};const n=(0,s.iH)([]),a=(0,s.iH)(!1),g=(0,s.iH)(""),p=(0,t.Fl)((()=>""!=g.value?r[g.value]["allOf"][0]["description"]:"-")),d=(0,t.Fl)((()=>""!=g.value?f(r[g.value]):[])),f=e=>{console.log("creating blitzar schema"),console.log(e);let o=[];return console.log("allOf"in e),"allOf"in e?Object.entries(e["allOf"][0]["properties"]).forEach((e=>{const[l,t]=e;let r={id:l,label:t["title"],component:"QInput"};"boolean"==t["type"]&&(r["component"]="QToggle"),"integer"!=t["type"]&&"float"!=t["type"]||(r["component"]="QInput",r["ui_component"]&&(r["component"]=t["ui_component"]),r["type"]="number",r["labelAlways"]=!0,t["exclusiveMinimum"]&&(r["min"]=t["exclusiveMinimum"]),t["exclusiveMaximum"]&&(r["max"]=t["exclusiveMaximum"]),t["minimum"]&&(r["min"]=t["minimum"]),t["maximum"]&&(r["max"]=t["maximum"])),t["allOf"]&&Object.keys(t["allOf"][0]).includes("enum")&&(r["component"]="QSelect",r["options"]=t["allOf"][0]["enum"]),r["slots"]={label:{component:"QTooltip",slot:`ℹ️ ${t["description"]||""} (default=${t["default"]})`,anchor:"bottom left",self:"top left"}},o.push(r)})):console.log("error, wrong format!, no direct props on main level"),console.log(o),o},b=()=>{c.api.get("/config/schema?schema_type=dereferenced").then((async e=>{console.log(e.data),r=e.data.properties,n.value=Object.keys(r),g.value=n.value[0],a.value=!0})).catch((o=>{console.log(o),console.log("error"),e.notify({message:"error getting scheme! check logs",color:"red"})}))};b();const v=()=>{a.value=!1,c.api.get("/config/current").then((async o=>{console.log(o.data),console.log(l.value),l.value=o.data,a.value=!0,e.notify({message:"config restored from server",color:"green"})})).catch((o=>{console.log(o),console.log("error"),e.notify({message:"error getting config!",color:"red"})}))},h=()=>{console.log("sync config to server"),console.log(l.value),c.api.post("/config/current",l.value).then((o=>{e.notify({message:"Persisted config, trying to restart service",color:"green"}),console.log(o)})).catch((o=>{if(o.response.data.detail){let l="check following fields:<br/>";return Object.values(o.response.data.detail).forEach((e=>{l+=e["loc"].join(" -> "),l+=`: ${e["msg"]}`,l+="<br/>"})),void e.notify({caption:"validation error",icon:"error",html:!0,message:`${l}`,color:"red"})}e.notify({message:"error saving config, check browser console and logs",color:"red"})}))};return(0,t.wF)((()=>console.log("Composition API beforemounted"))),(0,t.bv)((()=>console.log("Composition API mounted"))),{schema_blitzar:d,renderBlitzForm:a,mainStore:o,main_groups:n,group_description:p,selected_group:g,serverConfig:l,remoteProcedureCall:c.remoteProcedureCall,restoreConfig:v,uploadConfigAndPersist:h}}};var d=l(1639),f=l(9885),b=l(7817),v=l(7661),h=l(926),y=l(4458),_=l(627),C=l(8879),k=l(9984),w=l.n(k);const q=(0,d.Z)(p,[["render",a]]),P=q;w()(p,"components",{QPage:f.Z,QTabs:b.Z,QTab:v.Z,QSeparator:h.Z,QCard:y.Z,QPageSticky:_.Z,QBtn:C.Z})}}]);