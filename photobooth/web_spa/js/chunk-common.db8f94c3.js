"use strict";(globalThis["webpackChunkphotobooth_app_frontend"]=globalThis["webpackChunkphotobooth_app_frontend"]||[]).push([[996],{61292:(e,t,i)=>{i.d(t,{A:()=>j});i(10239);var l=i(61758),r=i(58790);const o={class:"q-ml-sm"},a={key:4,class:"q-mr-sm"},s={class:"q-mr-sm"},n={class:"text-subtitle2"},d={key:0,class:"full-height"},c={key:0,class:"full-height"},u=["src"],g={key:1,class:"full-height"},m=["src"],h={key:1,class:"full-height"},p={key:0,class:"full-height"},y=["src"],f={key:1,class:"full-height"},b=["src"];function S(e,t,i,S,v,I){const _=(0,l.g2)("q-btn"),w=(0,l.g2)("q-space"),k=(0,l.g2)("q-avatar"),R=(0,l.g2)("q-card-section"),A=(0,l.g2)("q-card-actions"),L=(0,l.g2)("q-card"),E=(0,l.g2)("q-dialog"),q=(0,l.g2)("q-icon"),x=(0,l.g2)("q-toolbar"),T=(0,l.g2)("q-linear-progress"),F=(0,l.g2)("q-header"),C=(0,l.g2)("q-img"),Q=(0,l.g2)("q-drawer"),D=(0,l.g2)("q-carousel-slide"),X=(0,l.g2)("q-carousel"),$=(0,l.g2)("vue-qrcode"),B=(0,l.g2)("q-page-sticky"),N=(0,l.g2)("q-page-container"),O=(0,l.g2)("q-layout"),W=(0,l.gN)("close-popup"),V=(0,l.gN)("touch-swipe");return I.emptyRepository?((0,l.uX)(),(0,l.Wv)(O,{key:1,view:"hhh Lpr ffr"},{default:(0,l.k6)((()=>[(0,l.eW)("EMPTY")])),_:1})):((0,l.uX)(),(0,l.Wv)(O,{key:0,view:"hhh Lpr ffr",onClick:I.abortTimer},{default:(0,l.k6)((()=>[(0,l.bF)(F,{elevated:"",class:"bg-primary text-white"},{default:(0,l.k6)((()=>[i.showToolbar?((0,l.uX)(),(0,l.Wv)(x,{key:0,class:"toolbar",id:"gallery-toolbar"},{default:(0,l.k6)((()=>[(0,l.bF)(_,{dense:"",flat:"",icon:"close",size:"1.5rem",onClick:t[0]||(t[0]=t=>e.$emit("closeEvent"))}),(0,l.bF)(w),S.uiSettingsStore.uiSettings.gallery_show_delete||i.singleItemView?((0,l.uX)(),(0,l.Wv)(_,{key:0,flat:"",class:"q-mr-sm",icon:"delete",label:e.$t("BTN_LABEL_GALLERY_DELETE"),onClick:t[1]||(t[1]=e=>S.confirmDeleteFile=!0)},null,8,["label"])):(0,l.Q3)("",!0),(0,l.bF)(E,{modelValue:S.confirmDeleteFile,"onUpdate:modelValue":t[3]||(t[3]=e=>S.confirmDeleteFile=e)},{default:(0,l.k6)((()=>[(0,l.bF)(L,{class:"q-pa-sm",style:{"min-width":"350px"},id:"gallery-confirm-delete-dialog"},{default:(0,l.k6)((()=>[(0,l.bF)(R,{class:"row items-center"},{default:(0,l.k6)((()=>[(0,l.bF)(k,{icon:"delete",color:"primary","text-color":"white"}),(0,l.Lk)("span",o,(0,r.v_)(e.$t("MSG_CONFIRM_DELETE_IMAGE")),1)])),_:1}),(0,l.bF)(A,{align:"right"},{default:(0,l.k6)((()=>[(0,l.bo)((0,l.bF)(_,{flat:"",label:e.$t("BTN_LABEL_CANCEL")},null,8,["label"]),[[W]]),(0,l.bo)((0,l.bF)(_,{label:e.$t("BTN_LABEL_DELETE_IMAGE"),color:"primary",onClick:t[2]||(t[2]=t=>{I.deleteItem(S.currentSlideId),e.$emit("closeEvent")})},null,8,["label"]),[[W]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),S.uiSettingsStore.uiSettings.gallery_show_download?((0,l.uX)(),(0,l.Wv)(_,{key:1,flat:"",class:"q-mr-sm",icon:"download",label:e.$t("BTN_LABEL_GALLERY_DOWNLOAD"),onClick:t[4]||(t[4]=e=>{S.openURL(i.itemRepository[S.currentSlideIndex]["full"])})},null,8,["label"])):(0,l.Q3)("",!0),S.uiSettingsStore.uiSettings.gallery_show_print?((0,l.uX)(),(0,l.Wv)(_,{key:2,flat:"",class:"q-mr-sm",icon:"print",label:e.$t("BTN_LABEL_GALLERY_PRINT"),onClick:t[5]||(t[5]=e=>I.printItem(S.currentSlideId))},null,8,["label"])):(0,l.Q3)("",!0),S.uiSettingsStore.uiSettings.gallery_show_filter&&S.uiSettingsStore.uiSettings.gallery_filter_userselectable.length>0?((0,l.uX)(),(0,l.Wv)(_,{key:3,flat:"",class:"q-mr-sm",icon:"filter",label:e.$t("BTN_LABEL_GALLERY_FILTER"),disabled:!I.getFilterAvailable(i.itemRepository[S.currentSlideIndex]["media_type"]),onClick:S.toggleRightDrawer},null,8,["label","disabled","onClick"])):(0,l.Q3)("",!0),(0,l.bF)(w),i.singleItemView?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",a,[(0,l.bF)(q,{name:"tag"}),(0,l.Lk)("span",null,(0,r.v_)(S.currentSlideIndex+1)+" / "+(0,r.v_)(i.itemRepository.length),1)])),(0,l.bF)(w),(0,l.Lk)("div",s,[(0,l.bF)(q,{name:"image"}),(0,l.eW)(" "+(0,r.v_)(i.itemRepository[S.currentSlideIndex]["caption"]),1)])])),_:1})):(0,l.Q3)("",!0),v.displayLinearProgressBar&&v.remainingSeconds>0?((0,l.uX)(),(0,l.Wv)(T,{key:1,class:"absolute",value:v.remainingSecondsNormalized,"animation-speed":"200",color:"grey",id:"gallery-linear-progress-bar"},null,8,["value"])):(0,l.Q3)("",!0),S.displayLoadingSpinner?((0,l.uX)(),(0,l.Wv)(T,{key:2,class:"absolute",indeterminate:"","animation-speed":"2100",color:"primary"})):(0,l.Q3)("",!0)])),_:1}),S.uiSettingsStore.uiSettings.gallery_show_filter&&I.getFilterAvailable(i.itemRepository[S.currentSlideIndex]["media_type"])&&i.showToolbar?((0,l.uX)(),(0,l.Wv)(Q,{key:0,class:"q-pa-sm",modelValue:S.rightDrawerOpen,"onUpdate:modelValue":t[6]||(t[6]=e=>S.rightDrawerOpen=e),side:"right",overlay:"",id:"gallery-drawer-filters"},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(S.uiSettingsStore.uiSettings.gallery_filter_userselectable,(e=>((0,l.uX)(),(0,l.Wv)(L,{class:"q-mb-sm",key:e},{default:(0,l.k6)((()=>[(0,l.bF)(R,{class:"q-pa-sm"},{default:(0,l.k6)((()=>[(0,l.bF)(C,{class:"rounded-borders",loading:"lazy",onClick:t=>I.applyFilter(S.currentSlideId,e),src:`/mediaprocessing/preview/${S.currentSlideId}/${e}`},null,8,["onClick","src"])])),_:2},1024),(0,l.bF)(R,{class:"q-pa-none q-pb-sm",align:"center"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",n,(0,r.v_)(e),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["modelValue"])):(0,l.Q3)("",!0),(0,l.bF)(N,{class:"q-pa-none galleryimagedetail full-height"},{default:(0,l.k6)((()=>[i.singleItemView?((0,l.uX)(),(0,l.CE)("div",d,[(0,l.bF)(L,{class:"column no-wrap flex-center full-height q-pa-sm"},{default:(0,l.k6)((()=>["video"!=this.itemRepository[0].media_type?((0,l.uX)(),(0,l.CE)("div",c,[(0,l.Lk)("img",{draggable:!1,class:"rounded-borders full-height",style:{"object-fit":"contain","max-width":"100%","max-height":"100%"},src:this.itemRepository[0].preview},null,8,u)])):((0,l.uX)(),(0,l.CE)("div",g,[(0,l.Lk)("video",{draggable:!1,src:this.itemRepository[0].preview,class:"rounded-borders full-height",muted:"",autoplay:"",style:{"object-fit":"contain","max-width":"100%","max-height":"100%"},controls:"controls"},null,8,m)]))])),_:1})])):((0,l.uX)(),(0,l.CE)("div",h,[(0,l.bo)(((0,l.uX)(),(0,l.Wv)(X,{class:"",style:{width:"100%",height:"100%"},"control-type":"flat","control-color":"primary",swipeable:"",animated:"",modelValue:S.currentSlideId,"onUpdate:modelValue":t[7]||(t[7]=e=>S.currentSlideId=e),autoplay:i.slideshowTimeout,draggable:"false",arrows:i.showToolbar,infinite:!0,"transition-prev":i.slideshowUseFade?"fade":"slide-right","transition-next":i.slideshowUseFade?"fade":"slide-left",onTransition:t[8]||(t[8]=(t,l)=>{if(i.randomOrder){let l=I.slicedImages.findIndex((e=>e.id==t));S.currentSlideIndex=e.rndIncides[l],l>2?(e.rndIncides=e.rndIncides.slice(1,5),e.rndIncides.push(Math.floor(Math.random()*i.itemRepository.length))):(e.rndIncides=e.rndIncides.slice(0,4),e.rndIncides.unshift(Math.floor(Math.random()*i.itemRepository.length)))}else S.currentSlideIndex=i.itemRepository.findIndex((e=>e.id===t));console.log("Showing slide ",S.currentSlideIndex),I.abortTimer()})},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(I.slicedImages,(e=>((0,l.uX)(),(0,l.Wv)(D,{key:e.id,name:e.id,class:"column no-wrap flex-center full-height q-pa-sm"},{default:(0,l.k6)((()=>["video"!=e.media_type?((0,l.uX)(),(0,l.CE)("div",p,[(0,l.Lk)("img",{draggable:!1,class:"rounded-borders full-height",style:{"object-fit":"contain","max-width":"100%","max-height":"100%"},src:e.preview},null,8,y)])):((0,l.uX)(),(0,l.CE)("div",f,[(0,l.Lk)("video",{draggable:!1,src:e.preview,class:"rounded-borders full-height",style:{"object-fit":"contain","max-width":"100%","max-height":"100%"},controls:"controls"},null,8,b)]))])),_:2},1032,["name"])))),128))])),_:1},8,["modelValue","autoplay","arrows","transition-prev","transition-next"])),[[V,S.handleSwipeDown,void 0,{mouse:!0,down:!0}]])])),S.uiSettingsStore.uiSettings.gallery_show_qrcode&&i.showToolbar?((0,l.uX)(),(0,l.Wv)(B,{key:2,position:"top-right",offset:[30,30]},{default:(0,l.k6)((()=>[(0,l.Lk)("div",null,[(0,l.bF)($,{type:"image/png",tag:"svg",margin:2,width:200,"error-correction-level":"low",color:{dark:"#111111",light:"#EEEEEE"},value:I.getImageQrData()},null,8,["value"])])])),_:1})):(0,l.Q3)("",!0)])),_:1})])),_:1},8,["onClick"]))}var v=i(71868),I=i(38734),_=i(20392),w=i(98384),k=i(43710);const R={props:{indexSelected:{type:Number,required:!0},itemRepository:{type:Array,required:!0},startTimerOnOpen:{type:Boolean,required:!1,default:!1},singleItemView:{type:Boolean,default:!1},showToolbar:{type:Boolean,default:!0},slideshowTimeout:{type:Number,default:0},slideshowUseFade:{type:Boolean,default:!1},randomOrder:{type:Boolean,default:!1}},computed:{emptyRepository(){return!this.itemRepository||0==this.itemRepository.length},slicedImages(){if(this.randomOrder)return this.currentSlideIndex,console.log(this.rndIncides.map((e=>this.itemRepository[e]))),this.rndIncides.map((e=>this.itemRepository[e]));var e=Math.max(0,this.currentSlideIndex-2),t=Math.max(0,this.currentSlideIndex+3);return console.log(this.itemRepository.slice(e,t)),this.itemRepository.slice(e,t)}},beforeCreate(){this.emptyRepository||(this.randomOrder?(this.rndIncides=Array.from({length:5},(()=>Math.floor(Math.random()*this.itemRepository.length))),this.currentSlideIndex=this.rndIncides[2]):this.currentSlideIndex=this.indexSelected,console.log("currentSlideIndex:",this.currentSlideIndex),this.currentSlideId=this.itemRepository[this.currentSlideIndex].id)},data(){return{intervalTimerId:null,remainingSeconds:0,remainingSecondsNormalized:0,displayLinearProgressBar:!0}},setup(){const e=(0,_.w)(),t=(0,I.KR)(!1);(0,k.A)();return{uiSettingsStore:e,openURL:w.A,fabRight:(0,I.KR)(!1),currentSlideId:(0,I.KR)(""),currentSlideIndex:(0,I.KR)(0),autoplay:(0,I.KR)(!1),showFilterDialog:(0,I.KR)(!1),displayLoadingSpinner:(0,I.KR)(!1),confirmDeleteFile:(0,I.KR)(!1),rightDrawerOpen:t,toggleRightDrawer(){t.value=!t.value},handleSwipeDown({evt:e}){console.log("TODO: add method to close dialog programmatically")}}},components:{VueQrcode:v.Ay},mounted(){this.startTimerOnOpen&&this.startTimer()},beforeUnmount(){clearInterval(this.intervalTimerId)},methods:{async reloadImg(e){await fetch(e,{cache:"reload",mode:"no-cors"});const t=(new Date).getTime();document.body.querySelectorAll(`img[src*='${e}']`).forEach((i=>{i.src=e+"#"+t}))},applyFilter(e,t){this.displayLoadingSpinner=!0,this.$api.get(`/mediaprocessing/applyfilter/${e}/${t}`).then((t=>{const i=this.itemRepository.findIndex((t=>t.id===e));this.reloadImg(this.itemRepository[i].full),this.reloadImg(this.itemRepository[i].preview),this.reloadImg(this.itemRepository[i].thumbnail),this.displayLoadingSpinner=!1})).catch((e=>{console.log(e),this.displayLoadingSpinner=!1}))},deleteItem(e){this.$api.get("/mediacollection/delete",{params:{image_id:e}}).then((e=>{console.log(e)})).catch((e=>console.log(e)))},printItem(e){this.$api.get(`/print/item/${e}`).then((e=>{console.log(e),this.$q.notify({message:"Started printing...",type:"positive",spinner:!0})})).catch((e=>{e.response?(console.log(e.response),425==e.response.status?this.$q.notify({message:e.response.data["detail"],caption:"Print Service",type:"info"}):this.$q.notify({message:e.response.data["detail"],caption:"Print Service",type:"negative"})):e.request?console.error(e.request):console.error("Error",e.message)}))},getFilterAvailable(e){return["image","collageimage","animationimage"].includes(e)},getImageQrData(){return this.itemRepository[this.currentSlideIndex]["share_url"]},abortTimer(){clearInterval(this.intervalTimerId),this.remainingSeconds=0,this.remainingSecondsNormalized=0},startTimer(){var e=this.uiSettingsStore.uiSettings["AUTOCLOSE_NEW_ITEM_ARRIVED"];console.log(`starting newitemarrived timer, duration=${e}`),this.remainingSeconds=e,this.intervalTimerId=setInterval((()=>{this.remainingSecondsNormalized=this.remainingSeconds/e,this.remainingSeconds-=.05,this.remainingSeconds<=0&&(clearInterval(this.intervalTimerId),this.$router.push({path:"/"}))}),50)}}};var A=i(12807),L=i(83333),E=i(60133),q=i(79351),x=i(69001),T=i(31173),F=i(57201),C=i(97569),Q=i(27066),D=i(53581),X=i(16334),$=i(24609),B=i(42876),N=i(22701),O=i(65287),W=i(71102),V=i(25113),M=i(58264),K=i(70918),P=i(62769),U=i(35724),G=i(98582),z=i.n(G);const Y=(0,A.A)(R,[["render",S]]),j=Y;z()(R,"components",{QLayout:L.A,QHeader:E.A,QToolbar:q.A,QBtn:x.A,QSpace:T.A,QDialog:F.A,QCard:C.A,QCardSection:Q.A,QAvatar:D.A,QCardActions:X.A,QIcon:$.A,QLinearProgress:B.A,QDrawer:N.A,QImg:O.A,QPageContainer:W.A,QCarousel:V.A,QCarouselSlide:M.A,QPageSticky:K.A}),z()(R,"directives",{ClosePopup:P.A,TouchSwipe:U.A})}}]);