import{h as t,C as S,V as w,W as L,_ as b,x as j,r as v,c as h,a1 as A,a2 as k,y as B,q as m,t as f,z as N,Z as u,j as a,A as E,a4 as g,F,bu as l,bv as P}from"./index.9cd9a530.js";import{Q as T}from"./QPageSticky.5ef7a90e.js";import{q,r as x,S as z,P as $,T as M,Q as I,U as O}from"./renderers.4f31a4e7.js";import"./QSelect.fb438523.js";import"./rtl.bfefc57d.js";import"./selection.255d8afd.js";import"./format.2a3572e1.js";import"./use-checkbox.9eedecf7.js";import"./use-panel.892d81b1.js";import"./QToolbarTitle.81e5af3d.js";import"./QLayout.f1bdb81a.js";import"./QHeader.ff1f132e.js";import"./QPage.5f2aaea3.js";const Q=(e,r)=>{const o=q(e);return x(o,r,(n,s)=>{if(typeof n=="string"&&typeof s=="string")return`${n} ${s}`}),o},R=e=>{const r=z(e);return r.addFormat("color","/^#([A-F0-9]{3,4}|[A-F0-9]{6}|[A-F0-9]{8})$/i"),r},G=[t("g",{transform:"translate(-20,-20)"},[t("path",{d:"M79.9,52.6C80,51.8,80,50.9,80,50s0-1.8-0.1-2.6l-5.1-0.4c-0.3-2.4-0.9-4.6-1.8-6.7l4.2-2.9c-0.7-1.6-1.6-3.1-2.6-4.5 L70,35c-1.4-1.9-3.1-3.5-4.9-4.9l2.2-4.6c-1.4-1-2.9-1.9-4.5-2.6L59.8,27c-2.1-0.9-4.4-1.5-6.7-1.8l-0.4-5.1C51.8,20,50.9,20,50,20 s-1.8,0-2.6,0.1l-0.4,5.1c-2.4,0.3-4.6,0.9-6.7,1.8l-2.9-4.1c-1.6,0.7-3.1,1.6-4.5,2.6l2.1,4.6c-1.9,1.4-3.5,3.1-5,4.9l-4.5-2.1 c-1,1.4-1.9,2.9-2.6,4.5l4.1,2.9c-0.9,2.1-1.5,4.4-1.8,6.8l-5,0.4C20,48.2,20,49.1,20,50s0,1.8,0.1,2.6l5,0.4 c0.3,2.4,0.9,4.7,1.8,6.8l-4.1,2.9c0.7,1.6,1.6,3.1,2.6,4.5l4.5-2.1c1.4,1.9,3.1,3.5,5,4.9l-2.1,4.6c1.4,1,2.9,1.9,4.5,2.6l2.9-4.1 c2.1,0.9,4.4,1.5,6.7,1.8l0.4,5.1C48.2,80,49.1,80,50,80s1.8,0,2.6-0.1l0.4-5.1c2.3-0.3,4.6-0.9,6.7-1.8l2.9,4.2 c1.6-0.7,3.1-1.6,4.5-2.6L65,69.9c1.9-1.4,3.5-3,4.9-4.9l4.6,2.2c1-1.4,1.9-2.9,2.6-4.5L73,59.8c0.9-2.1,1.5-4.4,1.8-6.7L79.9,52.6 z M50,65c-8.3,0-15-6.7-15-15c0-8.3,6.7-15,15-15s15,6.7,15,15C65,58.3,58.3,65,50,65z",fill:"currentColor"},[t("animateTransform",{attributeName:"transform",type:"rotate",from:"90 50 50",to:"0 50 50",dur:"1s",repeatCount:"indefinite"})])]),t("g",{transform:"translate(20,20) rotate(15 50 50)"},[t("path",{d:"M79.9,52.6C80,51.8,80,50.9,80,50s0-1.8-0.1-2.6l-5.1-0.4c-0.3-2.4-0.9-4.6-1.8-6.7l4.2-2.9c-0.7-1.6-1.6-3.1-2.6-4.5 L70,35c-1.4-1.9-3.1-3.5-4.9-4.9l2.2-4.6c-1.4-1-2.9-1.9-4.5-2.6L59.8,27c-2.1-0.9-4.4-1.5-6.7-1.8l-0.4-5.1C51.8,20,50.9,20,50,20 s-1.8,0-2.6,0.1l-0.4,5.1c-2.4,0.3-4.6,0.9-6.7,1.8l-2.9-4.1c-1.6,0.7-3.1,1.6-4.5,2.6l2.1,4.6c-1.9,1.4-3.5,3.1-5,4.9l-4.5-2.1 c-1,1.4-1.9,2.9-2.6,4.5l4.1,2.9c-0.9,2.1-1.5,4.4-1.8,6.8l-5,0.4C20,48.2,20,49.1,20,50s0,1.8,0.1,2.6l5,0.4 c0.3,2.4,0.9,4.7,1.8,6.8l-4.1,2.9c0.7,1.6,1.6,3.1,2.6,4.5l4.5-2.1c1.4,1.9,3.1,3.5,5,4.9l-2.1,4.6c1.4,1,2.9,1.9,4.5,2.6l2.9-4.1 c2.1,0.9,4.4,1.5,6.7,1.8l0.4,5.1C48.2,80,49.1,80,50,80s1.8,0,2.6-0.1l0.4-5.1c2.3-0.3,4.6-0.9,6.7-1.8l2.9,4.2 c1.6-0.7,3.1-1.6,4.5-2.6L65,69.9c1.9-1.4,3.5-3,4.9-4.9l4.6,2.2c1-1.4,1.9-2.9,2.6-4.5L73,59.8c0.9-2.1,1.5-4.4,1.8-6.7L79.9,52.6 z M50,65c-8.3,0-15-6.7-15-15c0-8.3,6.7-15,15-15s15,6.7,15,15C65,58.3,58.3,65,50,65z",fill:"currentColor"},[t("animateTransform",{attributeName:"transform",type:"rotate",from:"0 50 50",to:"90 50 50",dur:"1s",repeatCount:"indefinite"})])])];var U=S({name:"QSpinnerGears",props:w,setup(e){const{cSize:r,classes:o}=L(e);return()=>t("svg",{class:o.value,width:r.value,height:r.value,viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid",xmlns:"http://www.w3.org/2000/svg"},G)}});const D=j(),i=v({}),W=Q(M,{control:{label:"q-label"}}),J=[...I],c=v(!0);let d=null;const V=async()=>{c.value=!0,console.log(1),await Y(),console.log(2),await C("currentActive"),console.log(3),console.log("disable loadscreen"),c.value=!1},Y=async()=>{try{const e=await fetch("/api/admin/config/schema?schema_type=dereferenced");console.log(e),d=await e.json(),console.log("updated schema!")}catch(e){console.warn(e),l.create({message:"error getting scheme! check logs",color:"red"})}finally{}},C=async(e="current")=>{try{const r=await fetch(`/api/admin/config/${e}`);console.log(r),i.value=await r.json()}catch(r){console.warn(r),l.create({message:"error getting config!",color:"red"})}finally{}},Z=()=>{console.log("sync config to server"),console.log(i.value),P.post("/admin/config/current",i.value).then(e=>{D.initStore(!0),l.create({message:"Config persisted and reloaded from server. If changed hardware settings, pls reload/restart services!",color:"green"})}).catch(e=>{if(e.response){let r="check following fields:<br/>";Object.values(e.response.data.detail).forEach(o=>{r+=o.loc.join(" -> "),r+=`: ${o.msg}`,r+="<br/>"}),l.create({caption:"validation error",icon:"error",html:!0,message:`${r}`,color:"red"});return}else e.request?console.error(e.request):console.error("Error",e.message);l.create({message:"error saving config, check browser console and logs",color:"red"})})},H=h(()=>c.value?null:d),K=h(()=>c.value?null:O(d,"TopLevelNavigation")),X={computed:{},components:{JsonForms:$},data(){return this.ajv=R(),{renderers:Object.freeze(J),cschema:H,cuischema:K,serverConfig:i,isLoadingState:c}},methods:{onChange(e){this.serverConfig=e.data}},provide(){return{styles:W}},setup(){const e=A();return V(),{store:e,uploadConfigAndPersist:Z,remoteProcedureCall:k,getConfig:C}}},ee={key:1,class:"q-pa-md flex flex-center"},re=u("div",null,"Please wait while loading config...",-1),oe={class:"q-gutter-sm"};function se(e,r,o,n,s,y){const _=B("json-forms");return m(),f(F,null,[s.isLoadingState?(m(),f("div",ee,[u("div",null,[re,a(U,{size:"xl",color:"primary"})])])):(m(),N(_,{key:0,data:s.serverConfig,ajv:e.ajv,renderers:s.renderers,schema:s.cschema,uischema:s.cuischema,onChange:y.onChange},null,8,["data","ajv","renderers","schema","uischema","onChange"])),a(T,{position:"bottom-right",offset:[18,18]},{default:E(()=>[u("div",oe,[a(g,{label:e.$t("BTN_LABEL_RESET_CONFIG"),onClick:r[0]||(r[0]=p=>n.remoteProcedureCall("/admin/config/reset"))},null,8,["label"]),a(g,{label:e.$t("BTN_LABEL_RESTORE_CONFIG"),onClick:r[1]||(r[1]=p=>n.getConfig("current"))},null,8,["label"]),a(g,{color:"primary",label:e.$t("BTN_LABEL_PERSIST_CONFIG"),onClick:r[2]||(r[2]=p=>n.uploadConfigAndPersist())},null,8,["label"])])]),_:1})],64)}var he=b(X,[["render",se]]);export{he as default};
