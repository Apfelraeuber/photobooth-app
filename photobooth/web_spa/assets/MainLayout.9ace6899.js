import{Q as j,a as D}from"./QLayout.f1bdb81a.js";import{f as q,r as v,w as _,k as O,l as N,u as B,m as I,n as x,c as k,p as M,q as S,t as V,_ as P,d as Q,v as G,x as U,y as C,z as E,A as R,j as L,B as z}from"./index.9cd9a530.js";import{u as H}from"./use-quasar.04956589.js";function h(e){return O()?(N(e),!0):!1}function y(e){return typeof e=="function"?e():B(e)}const d=typeof window!="undefined"&&typeof document!="undefined";typeof WorkerGlobalScope!="undefined"&&globalThis instanceof WorkerGlobalScope;const J=Object.prototype.toString,K=e=>J.call(e)==="[object Object]",g=()=>+Date.now(),b=()=>{};function X(e,i){function t(...n){return new Promise((o,s)=>{Promise.resolve(e(()=>i.apply(this,n),{fn:i,thisArg:this,args:n})).then(o).catch(s)})}return t}function Y(...e){let i=0,t,n=!0,o=b,s,a,r,u,c;!q(e[0])&&typeof e[0]=="object"?{delay:a,trailing:r=!0,leading:u=!0,rejectOnCancel:c=!1}=e[0]:[a,r=!0,u=!0,c=!1]=e;const l=()=>{t&&(clearTimeout(t),t=void 0,o(),o=b)};return f=>{const p=y(a),w=Date.now()-i,A=()=>s=f();return l(),p<=0?(i=Date.now(),A()):(w>p&&(u||!n)?(i=Date.now(),A()):r&&(s=new Promise((T,W)=>{o=c?W:T,t=setTimeout(()=>{i=Date.now(),n=!0,T(A()),l()},Math.max(0,p-w))})),!u&&!t&&(t=setTimeout(()=>n=!0,p)),n=!1,s)}}function Z(e,i=1e3,t={}){const{immediate:n=!0,immediateCallback:o=!1}=t;let s=null;const a=v(!1);function r(){s&&(clearInterval(s),s=null)}function u(){a.value=!1,r()}function c(){const l=y(i);l<=0||(a.value=!0,o&&e(),r(),s=setInterval(e,l))}if(n&&d&&c(),q(i)||typeof i=="function"){const l=_(i,()=>{a.value&&d&&c()});h(l)}return h(u),{isActive:a,pause:u,resume:c}}function ee(e){var i;const t=y(e);return(i=t==null?void 0:t.$el)!=null?i:t}const F=d?window:void 0;d&&window.document;d&&window.navigator;d&&window.location;function $(...e){let i,t,n,o;if(typeof e[0]=="string"||Array.isArray(e[0])?([t,n,o]=e,i=F):[i,t,n,o]=e,!i)return b;Array.isArray(t)||(t=[t]),Array.isArray(n)||(n=[n]);const s=[],a=()=>{s.forEach(l=>l()),s.length=0},r=(l,m,f,p)=>(l.addEventListener(m,f,p),()=>l.removeEventListener(m,f,p)),u=_(()=>[ee(i),y(o)],([l,m])=>{if(a(),!l)return;const f=K(m)?{...m}:m;s.push(...t.flatMap(p=>n.map(w=>r(l,p,w,f))))},{immediate:!0,flush:"post"}),c=()=>{u(),a()};return h(c),c}function te(e,i={}){const{immediate:t=!0,fpsLimit:n=void 0,window:o=F}=i,s=v(!1),a=n?1e3/n:null;let r=0,u=null;function c(f){if(!s.value||!o)return;r||(r=f);const p=f-r;if(a&&p<a){u=o.requestAnimationFrame(c);return}r=f,e({delta:p,timestamp:f}),u=o.requestAnimationFrame(c)}function l(){!s.value&&o&&(s.value=!0,r=0,u=o.requestAnimationFrame(c))}function m(){s.value=!1,u!=null&&o&&(o.cancelAnimationFrame(u),u=null)}return t&&l(),h(m),{isActive:I(s),pause:m,resume:l}}const ne=["mousemove","mousedown","resize","keydown","touchstart","wheel"],oe=6e4;function ie(e=oe,i={}){const{initialState:t=!1,listenForVisibilityChange:n=!0,events:o=ne,window:s=F,eventFilter:a=Y(50)}=i,r=v(t),u=v(g());let c;const l=()=>{r.value=!1,clearTimeout(c),c=setTimeout(()=>r.value=!0,e)},m=X(a,()=>{u.value=g(),l()});if(s){const f=s.document;for(const p of o)$(s,p,m,{passive:!0});n&&$(f,"visibilitychange",()=>{f.hidden||m()}),l()}return{idle:r,lastActive:u,reset:l}}function se(e={}){const{controls:i=!1,offset:t=0,immediate:n=!0,interval:o="requestAnimationFrame",callback:s}=e,a=v(g()+t),r=()=>a.value=g()+t,u=s?()=>{r(),s(a.value)}:r,c=o==="requestAnimationFrame"?te(u,{immediate:n}):Z(u,o,{immediate:n});return i?{timestamp:a,...c}:a}const re={__name:"RouteAfterTimeout",props:{route:{type:String,required:!0},timeout_ms:{type:Number,required:!0},warning_message:{type:String,default:"Auto-starting slideshow... Click anywhere to stay on this page."},warning_time_ms:{type:Number,default:1e4}},setup(e){const i=H(),t=x(),n=e,{idle:o,lastActive:s}=ie(n.timeout_ms),a=se({interval:1e3}),r=k(()=>n.timeout_ms-(a.value-s.value)),u=k(()=>n.warning_time_ms>r.value);let c=null;function l(){c=i.notify({progress:!0,message:n.warning_message,type:"info",multiline:!0,timeout:r.value,icon:"slideshow"})}function m(){c&&c()}return M(()=>{m()}),_(u,f=>{f?l():m()}),_(o,f=>{f&&(m(),t.push({path:n.route}))}),(f,p)=>(S(),V("div"))}},ae=Q({name:"MainLayout",components:{RouteAfterTimeout:re},computed:{},setup(){const e=G(),i=U(),t=x();return e.$subscribe((n,o)=>{o.state=="counting"&&t.path!="/"&&(console.log("counting state received, pushing to index page to countdown"),t.push("/")),o.state=="present_capture"&&t.push({path:"/itempresenter"}),o.state=="approve_capture"&&o.ask_user_for_approval&&t.push({path:"/itemapproval"})}),{uiSettingsStore:i}}});function ue(e,i,t,n,o,s){const a=C("router-view"),r=C("RouteAfterTimeout");return S(),E(D,{view:"hHh lpR fFf"},{default:R(()=>[L(j,null,{default:R(()=>[L(a),this.uiSettingsStore.uiSettings.show_automatic_slideshow_timeout>0?(S(),E(r,{key:0,route:"/slideshow/random",timeout_ms:this.uiSettingsStore.uiSettings.show_automatic_slideshow_timeout*1e3,warning_message:e.$t("MSG_WARN_BEFORE_AUTO_SLIDESHOW")},null,8,["timeout_ms","warning_message"])):z("",!0)]),_:1})]),_:1})}var me=P(ae,[["render",ue]]);export{me as default};
